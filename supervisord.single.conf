[supervisord]
nodaemon=true
logfile=/dev/stdout
logfile_maxbytes=0
pidfile=/tmp/supervisord.pid
user=root ; Added to avoid the "running as root" warning

; --- 1. SurrealDB Process ---
; This runs your database, persisting data to /mydata
[program:surrealdb]
command=surreal start --log trace --user root --pass root rocksdb:/mydata/mydatabase.db
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
autorestart=true
priority=30 ; <-- CHANGED (starts first)
autostart=true
startsecs=5

; --- 2. API Process ---
; This runs your Python/Uvicorn API on port 5055
[program:api]
command=bash -c "sleep 5 && uv run uvicorn api.main:app --host 0.0.0.0 --port 5055" ; <-- CHANGED (added sleep 5)
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
autorestart=true
priority=20 ; <-- CHANGED (starts second)
autostart=true
startsecs=3

; --- 3. Worker Process ---
; This runs your surreal-commands-worker
[program:worker]
command=uv run surreal-commands-worker --import-modules commands
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
autorestart=true
priority=10 ; <-- CHANGED (starts last)
autostart=true
startsecs=3

; --- NOTE: NO FRONTEND PROCESS ---
; The [program:frontend] has been removed.
; Your frontend is correctly defined as a separate service 
; in your 'open-notebook.yaml' file and should not be run 
; inside your backend container.

